import{_ as j,r as y,u as z,q as L,o as a,c as n,a as l,z as d,A as v,h as p,w as f,B as c,t as k,C as O,g as u,F as w,f as x,j as T,v as G,x as H}from"./index-CJep6T-l.js";const r=C=>(G("data-v-23fc36c8"),C=C(),H(),C),J={class:"page__container"},K={key:0},Q=r(()=>l("h1",{class:"page__title"},"Авторизация",-1)),R={key:1},W=r(()=>l("h1",{class:"page__title"},"Панель",-1)),X={class:"admin__title"},Y={class:"form__create"},Z=r(()=>l("label",{for:"type"},"Тип:",-1)),ee=r(()=>l("option",{value:"product"},"Продукт",-1)),te=r(()=>l("option",{value:"recipe"},"Рецепт",-1)),oe=r(()=>l("option",{value:"box"},"Бокс",-1)),le=[ee,te,oe],se=r(()=>l("label",{for:"name"},"Название:",-1)),ae={key:0,for:"description"},ne={key:2,for:"composition"},ie=r(()=>l("label",{for:"price"},"Цена:",-1)),re={key:4,for:"section"},ue={key:6,for:"structure"},ce=r(()=>l("label",{for:"photo"},"Фотография товара:",-1)),de={key:8},pe={key:9},ve={style:{display:"flex",gap:"12px","align-items":"center","margin-bottom":"12px"}},me=r(()=>l("label",{for:"itemDescription"},"Описание элемента:",-1)),_e=["onUpdate:modelValue"],he=r(()=>l("label",{style:{"margin-top":"12px"},for:"itemPhotos"},"Фотографии элемента:",-1)),ye=["onChange"],fe=r(()=>l("h2",{class:"admin__title"},"Рецепты",-1)),ke={class:"admin__item-wrapper"},ge=r(()=>l("h2",{class:"admin__title"},"Боксы",-1)),be={class:"admin__item-wrapper"},we={key:0},xe=r(()=>l("h2",{class:"admin__title"},"Товары по секциям",-1)),Ce={class:"section_name"},Ve={class:"admin__item-wrapper"},Pe={__name:"AdminView",setup(C){const P=y(""),U=y(""),V=y(!1),g=z(),h=y({}),t=y({type:"product",name:"",description:"",composition:"",price:"",section:"",structure:"",photos:[],items:[]}),m=y(null),S=(s,o)=>{m.value={...s,type:o},t.value={...m.value}},$=()=>{m.value=null,t.value={type:"product",name:"",description:"",composition:"",price:"",section:"",structure:"",photos:[],items:[]}},B=async()=>{try{const s={type:t.value.type,name:t.value.name,description:t.value.description,composition:t.value.composition,price:t.value.price,section:t.value.section,structure:t.value.structure,items:t.value.items};await g.editProduct(m.value.id,s),await b(),$()}catch(s){console.error("Error updating product:",s)}},I=()=>{t.value.items.push({description:"",itemPhotos:[]})},q=s=>{t.value.items.splice(s,1)},A=async()=>{try{const{success:s}=await g.auth(P.value,U.value);s&&(V.value=!0,localStorage.setItem("isAuthenticated","true"),await b())}catch(s){console.error("Error logging in:",s)}},b=async()=>{try{const s=await g.getAllProduct();h.value=s}catch(s){console.error("Error fetching products:",s)}},D=async()=>{try{const s=new FormData;for(const o in t.value)o==="photos"?t.value.photos.forEach(e=>s.append("photos",e)):o==="items"?t.value.items.forEach((e,i)=>{s.append(`items[${i}][description]`,e.description),e.itemPhotos.forEach((_,N)=>{s.append(`items[${i}][itemPhotos][${N}]`,_)})}):s.append(o,t.value[o]);await g.createNewProduct(s),await b(),t.value={type:"product",name:"",description:"",composition:"",price:"",section:"",structure:"",photos:[],items:[]}}catch(s){console.error("Error creating product:",s)}},F=s=>{const o=s.target.files;o.length&&(t.value.photos=Array.from(o))},M=(s,o)=>{const e=s.target.files;e.length&&(t.value.items[o].itemPhotos=Array.from(e))},E=async(s,o)=>{try{await g.deleteOneProduct(s,o),await b()}catch(e){console.error("Error deleting product:",e)}};return L(async()=>{V.value=!!localStorage.getItem("isAuthenticated"),V.value&&await b()}),(s,o)=>(a(),n("div",J,[V.value?(a(),n("div",R,[W,l("h2",X,k(m.value?"Редактировать товар":"Создать новый товар"),1),l("form",Y,[Z,d(l("select",{"onUpdate:modelValue":o[2]||(o[2]=e=>t.value.type=e),required:""},le,512),[[O,t.value.type]]),se,d(l("input",{"onUpdate:modelValue":o[3]||(o[3]=e=>t.value.name=e),type:"text",placeholder:"Название",required:""},null,512),[[v,t.value.name]]),t.value.type!=="box"?(a(),n("label",ae,"Описание:")):u("",!0),t.value.type!=="box"?d((a(),n("textarea",{key:1,"onUpdate:modelValue":o[4]||(o[4]=e=>t.value.description=e),placeholder:"Описание"},null,512)),[[v,t.value.description]]):u("",!0),t.value.type==="product"?(a(),n("label",ne,"Состав:")):u("",!0),t.value.type==="product"?d((a(),n("textarea",{key:3,"onUpdate:modelValue":o[5]||(o[5]=e=>t.value.composition=e),placeholder:"Состав (для продуктов)"},null,512)),[[v,t.value.composition]]):u("",!0),ie,d(l("input",{"onUpdate:modelValue":o[6]||(o[6]=e=>t.value.price=e),type:"number",placeholder:"Цена",required:""},null,512),[[v,t.value.price]]),t.value.type==="product"?(a(),n("label",re,"Секция:")):u("",!0),t.value.type==="product"?d((a(),n("input",{key:5,"onUpdate:modelValue":o[7]||(o[7]=e=>t.value.section=e),type:"text",placeholder:"Секция"},null,512)),[[v,t.value.section]]):u("",!0),t.value.type==="box"?(a(),n("label",ue,"Структура:")):u("",!0),t.value.type==="box"?d((a(),n("textarea",{key:7,"onUpdate:modelValue":o[8]||(o[8]=e=>t.value.structure=e),placeholder:"Структура бокса"},null,512)),[[v,t.value.structure]]):u("",!0),ce,l("input",{type:"file",multiple:"",onChange:F},null,32),t.value.type==="box"?(a(),n("label",de,"Элементы бокса:")):u("",!0),t.value.type==="box"?(a(),n("div",pe,[(a(!0),n(w,null,x(t.value.items,(e,i)=>(a(),n("div",{key:i,class:"box-item"},[l("h3",null,"Элемент "+k(i+1),1),l("div",ve,[me,d(l("textarea",{"onUpdate:modelValue":_=>e.description=_,placeholder:"Описание элемента",required:""},null,8,_e),[[v,e.description]])]),he,l("input",{style:{"margin-bottom":"12px"},type:"file",multiple:"",onChange:_=>M(_,i)},null,40,ye),p(c,{onClick:f(_=>q(i),["prevent"]),title:"Удалить элемент",style:{"margin-bottom":"12px"}},null,8,["onClick"])]))),128)),p(c,{onClick:f(I,["prevent"]),title:"Добавить элемент"})])):u("",!0),p(c,{onClick:o[9]||(o[9]=f(e=>m.value?B():D(),["prevent"])),title:m.value?"Сохранить":"Создать"},null,8,["title"]),m.value?(a(),T(c,{key:10,onClick:f($,["prevent"]),title:"Отмена"})):u("",!0)]),fe,l("div",ke,[(a(!0),n(w,null,x(h.value.recipes,e=>(a(),n("div",{class:"admin__item",key:e.id},[l("p",null,k(e.name),1),p(c,{onClick:i=>S(e,"recipe"),title:"Редактировать"},null,8,["onClick"]),p(c,{onClick:i=>E(e.id,"recipe"),title:"удалить"},null,8,["onClick"])]))),128))]),ge,l("div",be,[(a(!0),n(w,null,x(h.value.boxes,e=>(a(),n("div",{class:"admin__item",key:e.id},[l("p",null,k(e.name),1),p(c,{onClick:i=>S(e,"box"),title:"Редактировать"},null,8,["onClick"]),p(c,{onClick:i=>E(e.id,"box"),title:"удалить"},null,8,["onClick"])]))),128))]),h.value.productsBySections&&h.value.productsBySections.length?(a(),n("div",we,[xe,(a(!0),n(w,null,x(h.value.productsBySections,e=>(a(),n("div",{key:e.section_name},[l("h3",Ce,k(e.section_name),1),l("div",Ve,[(a(!0),n(w,null,x(e.products,i=>(a(),n("div",{class:"admin__item",key:i.id},[l("p",null,k(i.name),1),p(c,{onClick:_=>S(i,"product"),title:"Редактировать"},null,8,["onClick"]),p(c,{onClick:_=>E(i.id,"product"),title:"удалить"},null,8,["onClick"])]))),128))])]))),128))])):u("",!0)])):(a(),n("div",K,[Q,l("form",{onSubmit:f(A,["prevent"])},[d(l("input",{"onUpdate:modelValue":o[0]||(o[0]=e=>P.value=e),placeholder:"Имя",required:""},null,512),[[v,P.value]]),d(l("input",{"onUpdate:modelValue":o[1]||(o[1]=e=>U.value=e),type:"password",placeholder:"Пароль",required:""},null,512),[[v,U.value]]),p(c,{onClick:f(A,["prevent"]),title:"Вход"})],32)]))]))}},Se=j(Pe,[["__scopeId","data-v-23fc36c8"]]);export{Se as default};
